<html>
<head>
	<title>KunchaCiphers</title>
	<style>
		button {
			padding: 8px 6px;
		}
		p, h1{
			text-align: center;
			margin: 3px 8px;
		}
		div.dv{
			position: relative;
			display: inline-block;
		}
		div.fl{
			width: 100%;
			height: 100%;
			position: relative;
			display: flex;
			align-items: stretch;
		}
		div.fl .cl{
			flex-direction: column;
		}
		div.fl *{
			flex: 1;
		}
		div.fl div{
			display: flex;
			align-items: stretch;
		}
		div.fl .ig{
			flex: initial;
		}
		div.fl button{
		}
		div.fl textarea{
			resize: none;
		}
		#pp{
			padding: 8px 6px;
		}
	</style>
</head>
<body>
	<center><h1>Kuncha Ciphers</h1></center>
	<div class="fl" style="height: 70%; width: 100%;">
		<div class="cl">
			<div class="cl">
				<textarea id="inp"></textarea>
				<div class="ig">
					<button onclick="convertCiphers(0, -1)">Decrypt</button>
					<button onclick="convertCiphers(0, 1)">Encrypt</button>
				</div>
			</div>
		</div>
		<div class="cl">
			<div class="cl">
				<p class="ig" id="op1n"></p>
				<textarea id="op1" readonly></textarea>
				<div class="ig">
					<button onclick="convertCiphers(1, -1)">Fast Decrypt</button>
					<button onclick="convertCiphers(1, 1)">Fast Encrypt</button>
				</div>
			</div>
			<div class="cl">
				<p class="ig" id="op2n" readonly></p>
				<textarea id="op2"></textarea>
				<div class="ig">
					<button onclick="convertCiphers(2, -1)">Fast Decrypt</button>
					<button onclick="convertCiphers(2, 1)">Fast Encrypt</button>
				</div>
			</div>
		</div>
	</div>
	<center>
	<input type="text" id="pp" size="50" placeholder="PASSPHRASE"/>
	</center>
	<script>
	  var inp = document.getElementById("inp");
	  var op1 = document.getElementById("op1");
	  var op2 = document.getElementById("op2");
	  var op1n= document.getElementById("op1n");
	  var op2n= document.getElementById("op2n");
		
		var pss = document.getElementById("pp");
	  
		var upoffset = 65;
		var lowoffset = 97;
			
	  function mod(num,mod){
	    return ((num%mod)+mod)%mod;
	  }
		
		var ciphers = [];
		
		ciphers[0] = [
		"Kunchakisa v1",
		"Added somewhat between January 30 to February 1. The initial version",
	  function encrypt(text, pass){
	    var phd = 0;
			var passphrase = pass.toUpperCase();
			var passcode = [];
			var input=text;
			var result="";
			
			// Define pass code from the passphrase
			for(var i=0;i<passphrase.length;i++){
				passcode[i] = passphrase.charCodeAt(i)-upoffset;
			}
			
			// Start encode
			for(var i=0;i<input.length;i++){
				// Current charcode
				var charcode = input.charCodeAt(i);
				// If lowcase
				var lowcase = charcode>=lowoffset&&charcode<lowoffset+26;
				// If highcase
				var upcase = charcode>=upoffset&&charcode<upoffset+26;
				
				// Define ncharcode
				var ncharcode = charcode;
				
				// If must be edited
				if(lowcase||upcase){
					// Compute offset
					var offset = lowcase?lowoffset:upoffset;
					
					// Get code
					var code = charcode - offset;
					
					// Compute new code
					ncode = mod(code + passcode[(i+phd)%passcode.length] + phd, 26);
					
					// compute new charcode
					ncharcode = ncode + offset;
					
					// Add distorter
					phd = mod(phd + ncode, 26);
				}
				// Add result string
				result+=String.fromCharCode(ncharcode);
			}
			
			return result;
	  },
		function decrypt(text, pass){
			var phd = 0;
			var passphrase = pass.toUpperCase();
			var passcode = [];
			var input=text;
			var result="";
			
			for(var i=0;i<passphrase.length;i++){
				passcode[i] = passphrase.charCodeAt(i)-upoffset;
			}
			
			for(var i=0;i<input.length;i++){
				var charcode = input.charCodeAt(i);
				var lowcase = charcode>=lowoffset&&charcode<lowoffset+26;
				var upcase = charcode>=upoffset&&charcode<upoffset+26;
			
				var ncharcode = charcode;
				
				if(lowcase||upcase){
					var offset = lowcase?lowoffset:upoffset;
					var code = charcode - offset;
					ncode = mod(code - passcode[(i+phd)%passcode.length] - phd, 26);
					ncharcode = ncode + offset;
					phd = mod(phd + code, 26);
				}
				result+=String.fromCharCode(ncharcode);
			}
			
			return result;
	  }
		];
		
		ciphers[1] = [
		"Kunchakisa Revised",
		"Added version recognition. The encryption was made more chaotic. Coded on February 2, 2019. The second version",
	  function encrypt(text, pass){
	    var phd = 1;
			var passphrase = "X" + pass.toUpperCase();
			var passcodei = [];
			var passcode = [];
			var input=text;
			var result="";
			var adder=0;
			
			// Define pass code from the passphrase
			for(var i=0;i<passphrase.length;i++){
				adder+=(passcodei[i] = passphrase.charCodeAt(i)-upoffset);
			}
			
			var rprime1 = 17;
			var rprime2 = 29
			var ranceil = 6969420;
			var randval = adder;
			
			// Mix up their orders
			for(var i=0;passcodei.length>0;i=i){
				randval = (randval * rprime1 + rprime2)%ranceil;
				var indexremove = randval%passcodei.length;
				passcode[passcode.length] = passcodei[indexremove];
				passcodei.splice(indexremove);
			}
			
			// Start encode
			for(var i=0;i<input.length;i++){
				// Current charcode
				var charcode = input.charCodeAt(i);
				// If lowcase
				var lowcase = charcode>=lowoffset&&charcode<lowoffset+26;
				// If highcase
				var upcase = charcode>=upoffset&&charcode<upoffset+26;
				
				// Define ncharcode
				var ncharcode = charcode;
				
				// If must be edited
				if(lowcase||upcase){
					// Compute offset
					var offset = lowcase?lowoffset:upoffset;
					
					// Get code
					var code = charcode - offset;
					
					// Compute new code
					ncode = mod(code + passcode[(i+phd)%passcode.length] + phd + adder, 26);
					
					// compute new charcode
					ncharcode = ncode + offset;
					
					// Add distorter
					phd = mod(phd + ncode, 26);
				}
				// Add result string
				result+=String.fromCharCode(ncharcode);
			}
			
			return result;
	  },
		function decrypt(text, pass){
			var phd = 1;
			var passphrase = "X" + pass.toUpperCase();
			var passcodei = [];
			var passcode = [];
			var input=text;
			var result="";
			var adder=0;
			
			// Define pass code from the passphrase
			for(var i=0;i<passphrase.length;i++){
				adder+=(passcodei[i] = passphrase.charCodeAt(i)-upoffset);
			}
			
			var rprime1 = 17;
			var rprime2 = 29
			var ranceil = 6969420;
			var randval = adder;
			
			// Mix up their orders
			for(var i=0;passcodei.length>0;i=i){
				randval = (randval * rprime1 + rprime2)%ranceil;
				var indexremove = randval%passcodei.length;
				passcode[passcode.length] = passcodei[indexremove];
				passcodei.splice(indexremove);
			}
			
			for(var i=0;i<input.length;i++){
				var charcode = input.charCodeAt(i);
				var lowcase = charcode>=lowoffset&&charcode<lowoffset+26;
				var upcase = charcode>=upoffset&&charcode<upoffset+26;
			
				var ncharcode = charcode;
				
				if(lowcase||upcase){
					var offset = lowcase?lowoffset:upoffset;
					var code = charcode - offset;
					ncode = mod(code - passcode[(i+phd)%passcode.length] - phd - adder, 26);
					ncharcode = ncode + offset;
					phd = mod(phd + code, 26);
				}
				result+=String.fromCharCode(ncharcode);
			}
			
			return result;
	  }
		];
		
		function convertCiphers(bid, opid){
			var pass = pss.value;
			
			var operation = opid>0?3:2;
			if(bid == 0){
				var text = inp.value;
				
				op1.value = ciphers[0][operation](text,pass);
				op2.value = ciphers[1][operation](text,pass);
			}else if(bid == 1){
				var text = op1.value;
				op1.value = ciphers[0][operation](text,pass);
			}else if(bid == 2){
				var text = op2.value;
				op2.value = ciphers[1][operation](text,pass);
			}
		}
		
		// INITIALIZE THE BOXES
		inp.placeholder = "Welcome to KunchaCiphers!\n\nThis box is the input box and the right boxes are the output box\n\n"
			+"Fast functions on the right processes the element inside it and outputs it on the same box (Just try it, hehe)\n\n"
			+"The passphrase is like the password. No one can get your message unless they know your passphrase\n\n"
			+"This thing was made for educational and entertainment purpose only... Made by KUNCHAKISA ;)";
		op1n.innerHTML = ciphers[0][0];
		op2n.innerHTML = ciphers[1][0];
		op1.placeholder = ciphers[0][1];
		op2.placeholder = ciphers[1][1];
	</script>
</body>
</html>
